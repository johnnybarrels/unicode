{% extends "base.html" %}

{% block content %}
<!-- Put stuff here -->
<div class="row mx-2">
  <h1 class="page-heading">{{ course.name }} - {{ test.name }}</h1>
</div>

<div class="container new-question my-3 py-3">
  <div id="question-nav" class="row mx-1">
    <div id="nav-tab" class="nav nav-pills" role="tablist">
      {% for question in questions %}
      <a class="nav-item nav-link" id="question-{{ loop.index }}-tab" data-toggle="tab"
        href="#question-{{ loop.index }}" role="tab" aria-controls="question-{{ loop.index }}"
        aria-selected="false">Question
        {{ loop.index }}
      </a>
      {% endfor %}

      <a class="nav-item nav-link" id="nav-add-tab" data-toggle="tab" href="#new-question" role="tab"
        aria-controls="new-question" aria-selected="false">Add
        <i class="fas fa-plus"></i>
      </a>

    </div>
  </div>

  <div class="tab-content m-4" id="nav-tabContent">
    {% for question in questions %}
    <div class="tab-pane fade" id="question-{{ loop.index }}" role="tabpanel"
      aria-labelledby="question-{{ loop.index }}-tab">

      <form id="question-form" method="POST" action="">
        {{ form.hidden_tag() }}

        <div class="row">
          <div class="col-6">
            <div class="form-group q-description-{{ loop.index }} mb-4">
              <h4 class="subheading">{{ form.description.label }}</h4>
              {{ form.description(id="question-description", class="form-control", style="resize: none;") }}
              <script>
                $('.q-description-{{ loop.index }} > textarea').html('{{ question.question_string }}')
              </script>
            </div>
            {% if question.question_type == 2 %}
            <div class="form-group mb-4">
              <h4 class="subheading">Multiple Choice Options</h4>
              {{ form.mcq_1(class="form-control mb-1", value=question.mcq_1) }}
              {{ form.mcq_2(class="form-control mb-1", value=question.mcq_2) }}
              {{ form.mcq_3(class="form-control mb-1", value=question.mcq_3) }}
              {{ form.mcq_4(class="form-control", value=question.mcq_4) }}
            </div>
            {% endif %}
            {% if question.question_type in [1, 2] %}
            <div class="form-group mb-4">
              <h4 class="subheading">{{ form.solution.label }}</h4>
              {{ form.solution(class="form-control", value=question.answer) }}
            </div>
            {% endif %}
            <div class="form-group mb-4">
              <h4 class="subheading">{{ form.mark_alloc.label }}</h4>
              {{ form.mark_alloc(class="form-control", value=question.mark_alloc) }}
            </div>
            <div class="row mt-5"></div>
            {{ form.save(class="btn purple-btn") }}
            {{ form.delete(class="btn delete-btn") }}

          </div>

          <div class="col-6 editor-container">
            <div id="editor" class="editor">
              {% if question.code_string %}
              {{ question.code_string }}
              {% else %}
              # Optional: Create an example solution (not visible to students)
              {% endif %}
            </div>
          </div>
        </div>
      </form>
    </div>
    {% endfor %}

    <div class="tab-pane fade" id="new-question" role="tabpanel" aria-labelledby="nav-add-tab">

      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
          <input type="radio" name="options" id="mcq-option-1" autocomplete="off" checked
            onchange="newQuestionSelector(1)"> Output
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="options" id="mcq-option-2" autocomplete="off" onchange="newQuestionSelector(2)"> MCQ
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="options" id="mcq-option-3" autocomplete="off" onchange="newQuestionSelector(3)">
          Code
        </label>
      </div>

      <form id="new-question-form" method="POST"
        action="{{ url_for('new_question', course_id=course.id, test_id=test.id) }}">
        {{ form.hidden_tag() }}

        {{ form.question_type(id="question-type") }}

        <div class="row">
          <div class="col-6">
            <div class="form-group mb-4">
              <h4 class="subheading">{{ form.description.label }}</h4>
              {{ form.description(id="question-description", class="form-control", style="resize: none;", placeholder="eg. What does this function do?") }}
            </div>

            <div id="new-question-mcq" class="form-group mb-4" style="display: none;">
              <h4 class="subheading">Multiple Choice Options</h4>
              {{ form.mcq_1(class="form-control mb-1", placeholder='a)') }}
              {{ form.mcq_2(class="form-control mb-1", placeholder='b)') }}
              {{ form.mcq_3(class="form-control mb-1", placeholder='c)') }}
              {{ form.mcq_4(class="form-control", placeholder='d)') }}
            </div>

            <div id="new-question-solution" class="form-group mb-4">
              <h4 class="subheading">{{ form.solution.label }}</h4>
              {{ form.solution(class="form-control", placeholder='What is the correct solution?') }}
            </div>

            <div class="form-group mb-4">
              <h4 class="subheading">{{ form.mark_alloc.label }}</h4>
              {{ form.mark_alloc(class="form-control", placeholder='Please provide an integer mark value (eg. 5, 10)') }}
            </div>
            <div class="row mt-5"></div>
            {{ form.save(class="btn purple-btn") }}
            {{ form.delete(class="btn delete-btn") }}

          </div>

          <div class="col-6 editor-container">
            <div id="editor" class="editor new-question-ace"></div>
          </div>
        </div>
      </form>
    </div>
  </div>

</div>

{% endblock %}
